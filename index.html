<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hyper-3D GPT-4o Mini Chat</title>
<style>
body {
  margin: 0;
  font-family: Inter, system-ui, sans-serif;
  background: radial-gradient(circle at 50% 30%, #121212, #0b0b0b 80%);
  color: #e6e6e6;
  display: flex;
  flex-direction: column;
  height: 100vh;
  perspective: 1600px;
  overflow: hidden;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 20px;
  background: rgba(17,17,17,0.95);
  border-bottom: 1px solid #222;
  box-shadow: 0 4px 25px rgba(0,0,0,0.5);
}
header h1 {
  margin: 0;
  color: #00a67e;
  text-shadow: 0 0 15px #00a67e55;
}
header button {
  background: #1c1c1c;
  color: #e6e6e6;
  border: 1px solid #333;
  border-radius: 10px;
  padding: 6px 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 3px 12px rgba(0,0,0,0.4);
}
header button:hover { background: #333; transform: translateY(-2px) scale(1.05); }

#chat {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 22px;
  scroll-behavior: smooth;
}

.msg {
  max-width: 70%;
  padding: 16px 20px;
  border-radius: 12px;
  line-height: 1.5;
  white-space: pre-wrap;
  box-shadow: 0 8px 25px rgba(0,0,0,0.6);
  opacity: 0;
  transform: translateY(30px) translateZ(0);
  animation: fadeSlideIn 0.5s forwards;
  transition: transform 0.4s ease-out, opacity 0.4s ease-out, box-shadow 0.4s;
  display: flex;
  flex-direction: column;
  will-change: transform, opacity;
}
.user { align-self: flex-end; background: linear-gradient(145deg,#00a67e,#007d63); color:white; border:1px solid #008f72; }
.bot { align-self: flex-start; background:#1e1e1e; border:1px solid #333; }

#input-area {
  display: flex;
  border-top:1px solid #222;
  padding:12px;
  background: rgba(17,17,17,0.95);
  box-shadow: 0 -6px 25px rgba(0,0,0,0.5);
  align-items: center;
}
#prompt {
  flex:1;
  background: #1a1a1a;
  color:#eee;
  border:1px solid #333;
  border-radius:10px;
  padding:12px;
  font-family:inherit;
  font-size:1rem;
  box-shadow: inset 0 0 12px rgba(0,0,0,0.5);
  transition:0.3s;
}
#prompt:focus { border-color:#00a67e; outline:none; box-shadow:0 0 16px #00a67e44; }

button { margin-left:10px; border:none; border-radius:10px; color:white; padding:0 18px; font-size:1rem; cursor:pointer; transition:all 0.2s; box-shadow:0 3px 12px rgba(0,0,0,0.4);}
#send { background: linear-gradient(145deg,#00a67e,#009971); }
#send:hover { background:#00c291; transform:translateY(-1px); }
#send:disabled { opacity:0.5; cursor:not-allowed; }

#skipBtn { background:#444; }
#skipBtn:hover { background:#666; }

#clearBtn { background:#aa2222; }
#clearBtn:hover { background:#cc3333; }

#apiModal { position:fixed; inset:0; background: rgba(0,0,0,0.85); display:flex; justify-content:center; align-items:center; z-index:1000; opacity:0; animation:fadeIn 0.6s forwards;}
#apiModal div { background:#111; padding:28px; border-radius:15px; width:90%; max-width:500px; text-align:left; box-shadow:0 12px 45px rgba(0,0,0,0.6);}
#apiModal input { width:100%; padding:12px; background:#1a1a1a; border:1px solid #333; color:#eee; border-radius:8px; margin-top:8px;}
#apiModal button { margin-top:14px; background:#00a67e; border:none; color:white; padding:10px 22px; border-radius:8px; cursor:pointer; }

a { color:#00a67e; text-decoration:none; }
ol { padding-left:20px; margin:10px 0; }

@keyframes fadeSlideIn { 
  0% {opacity:0; transform:translateY(30px) translateZ(-50px);} 
  50% {transform:translateY(0) translateZ(50px);} 
  100% {opacity:1; transform:translateY(0) translateZ(0);} 
}
@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
</style>
</head>
<body>
<header>
  <h1>Hyper-3D GPT-4o Mini Chat</h1>
  <button id="changeKey">Change API Key</button>
</header>

<div id="chat"></div>

<div id="input-area">
  <textarea id="prompt" rows="1" placeholder="Type your message..."></textarea>
  <button id="send" disabled>Send</button>
  <button id="skipBtn">Skip Animation</button>
  <button id="clearBtn">Clear Chat</button>
</div>

<div id="apiModal" style="display:none;">
  <div>
    <h2>Enter your OpenAI API Key</h2>
    <p>Follow these steps to get one:</p>
    <ol>
      <li>Go to <a href="https://platform.openai.com/account/api-keys" target="_blank">platform.openai.com/account/api-keys</a></li>
      <li>Log in or sign up.</li>
      <li>Click “Create new secret key.”</li>
      <li>Copy the key (starts with <code>sk-</code>).</li>
      <li>Paste it below and click “Save Key.”</li>
    </ol>
    <input id="apiKeyInput" placeholder="sk-..." />
    <button id="saveKey">Save Key</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
const chat=document.getElementById('chat');
const promptInput=document.getElementById('prompt');
const sendBtn=document.getElementById('send');
const skipBtn=document.getElementById('skipBtn');
const clearBtn=document.getElementById('clearBtn');
const apiModal=document.getElementById('apiModal');
const apiKeyInput=document.getElementById('apiKeyInput');
const saveKeyBtn=document.getElementById('saveKey');
const changeKeyBtn=document.getElementById('changeKey');

let apiKey=localStorage.getItem('openai_api_key');
if(!apiKey) apiModal.style.display='flex';

changeKeyBtn.onclick=()=>{apiModal.style.display='flex'; apiKeyInput.value='';};
saveKeyBtn.onclick=()=>{
  apiKey=apiKeyInput.value.trim();
  if(apiKey.startsWith('sk-')){localStorage.setItem('openai_api_key',apiKey); apiModal.style.display='none';}
  else{alert('Enter a valid API key starting with sk-');}
};

promptInput.addEventListener('input',()=>{ sendBtn.disabled=promptInput.value.trim()===''; });

function decodeHtmlEntities(text){
  const txt=document.createElement('textarea');
  txt.innerHTML=text;
  return txt.value;
}

let currentTypeWriter=null;

function typeWriter(msgEl,text,speed=30){
  msgEl.textContent='';
  let i=0;
  let timeoutId;
  const nextChar=function(){
    if(i<text.length){
      msgEl.textContent+=text[i];
      i++;
      timeoutId=setTimeout(nextChar,speed);
      chat.scrollTop=chat.scrollHeight;
    }
  };
  nextChar();
  return { skip:()=>{ clearTimeout(timeoutId); msgEl.textContent=text; } };
}

// floating animation loop
function animate3D(){
  const messages = chat.querySelectorAll('.msg');
  const scrollTop = chat.scrollTop;
  messages.forEach((msg,index)=>{
    const depth = (index - scrollTop/80) * 12;
    const wiggleZ = 2*Math.sin(Date.now()/300 + index);
    msg.style.transform = `translateY(0px) translateZ(${depth+wiggleZ}px)`;
  });
  requestAnimationFrame(animate3D);
}
animate3D();

// load saved chat
window.addEventListener('load',()=>{
  const saved = JSON.parse(localStorage.getItem('chatHistory')||'[]');
  saved.forEach(msg=>{
    const msgEl=document.createElement('div');
    msgEl.className='msg '+msg.type;
    msgEl.textContent=msg.text;
    chat.appendChild(msgEl);
  });
  chat.scrollTop=chat.scrollHeight;
});

async function sendMessage(){
  const text=promptInput.value.trim();
  if(!text) return;
  promptInput.value='';
  sendBtn.disabled=true;

  const userMsg=document.createElement('div');
  userMsg.className='msg user';
  chat.appendChild(userMsg);

  let i=0;
  function typeUser(){ if(i<text.length){ userMsg.textContent+=text[i]; i++; setTimeout(typeUser,25); chat.scrollTop=chat.scrollHeight; } }
  typeUser();

  const botMsg=document.createElement('div');
  botMsg.className='msg bot';
  chat.appendChild(botMsg);

  // Pop-out effect
  botMsg.style.transform='translateY(0) translateZ(-50px)';
  setTimeout(()=>{ botMsg.style.transform='translateY(0) translateZ(0)'; }, 50);

  chat.scrollTop=chat.scrollHeight;

  try{
    const response=await fetch('https://api.openai.com/v1/chat/completions',{
      method:'POST',
      headers:{'Content-Type':'application/json','Authorization':`Bearer ${apiKey}`},
      body:JSON.stringify({model:'gpt-4o-mini', messages:[{role:'user',content:text}]})
    });
    const data=await response.json();
    let botText;
    if(response.status===401 || data.error?.message?.toLowerCase().includes('invalid')){
      botText='(No response from model — make sure you used a valid API key. To change yours, click the button in the top right corner.)';
    } else {
      botText=decodeHtmlEntities(
        marked.parse(data.choices?.[0]?.message?.content || 
          '(No response from model — make sure you used a valid API key. To change yours, click the button in the top right corner.)'
        ).replace(/<\/?[^>]+(>|$)/g,"")
      );
    }

    currentTypeWriter=typeWriter(botMsg, botText, 25);

  }catch(err){ botMsg.textContent='Error: '+err.message; }

  // save chat
  const chatHistory = Array.from(chat.querySelectorAll('.msg')).map(m=>({
    text:m.textContent,
    type:m.classList.contains('user')?'user':'bot'
  }));
  localStorage.setItem('chatHistory',JSON.stringify(chatHistory));

  chat.scrollTop=chat.scrollHeight;
  sendBtn.disabled=false;
}

// Skip button functionality
skipBtn.onclick=()=>{ if(currentTypeWriter) currentTypeWriter.skip(); };

// Clear chat button functionality
clearBtn.onclick=()=>{
  if(confirm("Are you sure you want to clear the chat?")){
    chat.innerHTML='';
    localStorage.removeItem('chatHistory');
  }
};

sendBtn.onclick=sendMessage;
promptInput.addEventListener('keypress',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();}});
</script>
</body>
</html>
